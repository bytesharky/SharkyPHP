# 项目更新说明

***
## 计划更新（时间不确定）

### 新增功能

- 路由中间件，允许添加中间件，在路由执行回调前先执行中间件逻辑，比如用于验证用户权限、进行请求日志记录等，中间件可以阻断请求继续执行路由回调或者放行让其执行。

## 2024-12-12

### 内容修正

- 修复路由注册函数 `reg` 生成正则表达式错误的情况；

- 修复错误页布局被打乱的问题。

### 功能改进

- 优化路由注册函数 `reg`，增加匹配模式 [ `matchMode` ] 参数 匹配开始：`MATCH_START`, 匹配结束：`MATCH_END`, 完全匹配：`MATCH_FULL`;

### 新增功能

- 新增路由注册函数 `prge_reg`，允许兹定于正则表达式；

- 模板引擎新增 `setLanguage` 函数，方便在实例化之后改变模板语言；

## 2024-12-7

### 功能改进

- 实现了模板继承和引用。

  - 修复 `{% extends 'base.html %}` 指令，指定要继承的父模板，注意：模版中只能包含一条该指令，且必须在开头，可以多层继承。
  - 修复 `{% block blockname %}...{% endblock %}` 指令，设置一个块作用域，在继承中会覆盖父模板中的同名块。
  - 新增 `{% include 'base.html %}` 指令，在当前位置引入两一个模板。

## 2024-12-1

### 功能改进

- 修改模版渲染方式，支持控制器中使用 `return` 返回[ `int`, `string`, `bool`, `array` ]类型的数据。

  - `int` ：自动识别常见的状态码并返回。

  - `string` ：直接 `echo` 输出到页面。

  - `bool`：`true` 返回200状态码，`false` 返回500状态码。
  
  - `array`：自动转为 `json`，并根据数组中的 `code` 设置状态码，默认为200。

- 路由派遣取消直接 `new` 控制器实例，改用容器完成控制器实例化，以便自动注入依赖。

- 新增 `config.restful` 配置，当值为 `json` 时，默认错误页面将被标准 `JSON` 替代。

## 2024-11-9

### 内容修正

- 更正说明文档几处内容错误

- 修改链接为相对链接，方便查阅

### 功能改进

- 修复模板翻译功能的BUG

- 修复Linux上的兼容问题

- 修复 `Database` 类中 `execute` 方法在 `mysqli` 模式的异常。

- 将自定义的 `Exception` 更名为 `SharkyException` 防止Try中意外捕获此类导致预期外的异常

## 2024-11-6

### 新增功能

- 修复已知的问题。

- 引入多站点复用框架的功能。

### 功能改进

- **简单容器**：实现 `make` 时自动绑定。
- **异常处理**：创建新的类，将异常处理从App类分离出来。
- **数据集合**：创建新的类，用于存储数据库查询的记录。
- **配置文件类**：更新加载逻辑，使其能够支持多站点模式。
- **数据库类**：增加 `runTransaction` 函数，该函数接收一个回调函数，会依据此回调函数的返回值（ `true` / `false` ）自动控制提交和回滚操作，同时依然可以通过 `beginTransaction` 、 `commit` 、 `rollback` 进行手动控制。
- **模型类**：对查询返回进行修改，返回结果不再是数组形式。其中， `find` 方法返回的是填充数据的模型，可继续进行链式操作； `select` 方法返回的是模型的集合，能够使用 `foreach` 循环进行遍历，且同样可继续链式操作。若想要获取数组形式的结果，可使用 `toArray` 方法。
- **路由类**：更新支持逻辑，以适配多站点模式，并且修复了url中出现问号导致404的问题。
- **模版引擎**：更新加载逻辑，以支持多站点模式。
- **启动程序**：更新加载逻辑，以支持多站点模式。

### 内容修正

- 增加说明文档，由AI生成后整理，有待完善...

### 其他调整

- 将 `common.php` 文件改为公共函数文件，用于存放全局函数。
- 新建 `constants.php` 文件，用于存放全局常量。

## 2024-11-5

### 功能改进

- 重新实现功能更丰富的模板引擎。

## 2024-11-4

### 内容修正

- 修改几处内容错误。

## 2024-11-3

### 项目进展

- 首次发布。

## 2024-11-1

### 项目启动

- 立项，突然想创建个项目玩。

- 就写个PHP框架吧，名字就暂定SharkyPHP。
