# 项目更新说明

***

## 2025-04-25

### 新增功能

- 新增 `Response` 类，响应相关的逻辑独立出来。

- 新增 `Cache` 类，用于管理缓存的工具类，它支持文件缓存和 Redis 缓存两种方式。

- 扩展了 `Redis` 类，支持更多常用方法。

- 新增 `redirect` 全局函数，用于便捷的返回一个重定向；

- 新增 `response` 全局函数，用于便捷的响应请求；

- `Request` 类新增一个 `headers` 属性，可获取全部请求头，可以从控制器的 `request` 属性获取当前请求的实例；

- 控制器新增 `response` 属性，可以获取响应的实例，但是建议使用 `response` 全局函数。

- 在应用目录下新增 `common.php`, 应用的全局函数写在这里，和框架全局函数的分离管理

- 在 `json` 和 `html` 的基础上新增 `xml` 响应支持，只需在 `.env` 文件中，修改 `APP_RESTFUL` 的值为 `xml` （严格小写）

  当然你不是必须这么做，你也可以使用 `response` 全局函数，链式调用 `xml`、`json`、`html` 方法来输出指定格式。

  `APP_RESTFUL`，只在你没有主动设置 `content-type` 时生效。



### 内容修正

- 修复了一些已知的问题

## 2025-04-23

### 新增功能

- 增加 `JWT` 类，方便你实现API 认证、单点登录等场景

- 增加 `MFA` 类，兼容 `Google Authenticator` , `Microsoft Authenticator`，方式实现两步身份验证

- 模型中增加 `jion` 方法以及 `leftJion`、`rightJion`、`innerJoin`、 `fullJoin` 便捷方法，实现了联合查询

### 内容修正

- 修复了一些已知的问题
  
## 2025-03-25

### 新增功能
  
- 增加了读取环境变量的功能，可以将敏感信息放在.env文件中，使用 `env` 函数读取；

- 增加了 `Redis` 相关类，实现Redis数据库的操作，支持读写分离模式；

- 增加了 `Database` 相关类，增加数据库表前缀和读写分离模式的支持；

### 内容修正

- 修复了一些已知的问题

## 2025-03-23

### 新增功能

- 路由中间件，允许添加中间件，在路由执行回调前先执行中间件逻辑，比如用于验证用户权限、进行请求日志记录等，中间件可以阻断请求继续执行路由回调或者放行让其执行。

- 在模型中增加了：`orderBy` 和 `groupBy` 方法；

### 内容修正

- 修复模板多级继承的解析的问题；

## 2024-12-12

### 内容修正

- 修复路由注册函数 `reg` 生成正则表达式错误的情况；

- 修复错误页布局被打乱的问题。

### 功能改进

- 优化路由注册函数 `reg`，增加匹配模式 [ `matchMode` ] 参数 匹配开始：`MATCH_START`, 匹配结束：`MATCH_END`, 完全匹配：`MATCH_FULL`;

### 新增功能

- 新增路由注册函数 `preg_reg`，允许兹定于正则表达式；

- 模板引擎新增 `setLanguage` 函数，方便在实例化之后改变模板语言；

## 2024-12-7

### 功能改进

- 实现了模板继承和引用。

  - 修复 `{% extends 'base.html %}` 指令，指定要继承的父模板，注意：模版中只能包含一条该指令，且必须在开头，可以多层继承。
  - 修复 `{% block blockname %}...{% endblock %}` 指令，设置一个块作用域，在继承中会覆盖父模板中的同名块。
  - 新增 `{% include 'base.html %}` 指令，在当前位置引入两一个模板。

## 2024-12-1

### 功能改进

- 修改模版渲染方式，支持控制器中使用 `return` 返回[ `int`, `string`, `bool`, `array` ]类型的数据。

  - `int` ：自动识别常见的状态码并返回。

  - `string` ：直接 `echo` 输出到页面。

  - `bool`：`true` 返回200状态码，`false` 返回500状态码。
  
  - `array`：自动转为 `json`，并根据数组中的 `code` 设置状态码，默认为200。

- 路由派遣取消直接 `new` 控制器实例，改用容器完成控制器实例化，以便自动注入依赖。

- 新增 `config.restful` 配置，当值为 `json` 时，默认错误页面将被标准 `JSON` 替代。

## 2024-11-9

### 内容修正

- 更正说明文档几处内容错误

- 修改链接为相对链接，方便查阅

### 功能改进

- 修复模板翻译功能的BUG

- 修复Linux上的兼容问题

- 修复 `Database` 类中 `execute` 方法在 `mysqli` 模式的异常。

- 将自定义的 `Exception` 更名为 `SharkyException` 防止Try中意外捕获此类导致预期外的异常

## 2024-11-6

### 新增功能

- 修复已知的问题。

- 引入多站点复用框架的功能。

### 功能改进

- **简单容器**：实现 `make` 时自动绑定。
- **异常处理**：创建新的类，将异常处理从App类分离出来。
- **数据集合**：创建新的类，用于存储数据库查询的记录。
- **配置文件类**：更新加载逻辑，使其能够支持多站点模式。
- **数据库类**：增加 `runTransaction` 函数，该函数接收一个回调函数，会依据此回调函数的返回值（ `true` / `false` ）自动控制提交和回滚操作，同时依然可以通过 `beginTransaction` 、 `commit` 、 `rollback` 进行手动控制。
- **模型类**：对查询返回进行修改，返回结果不再是数组形式。其中， `find` 方法返回的是填充数据的模型，可继续进行链式操作； `select` 方法返回的是模型的集合，能够使用 `foreach` 循环进行遍历，且同样可继续链式操作。若想要获取数组形式的结果，可使用 `toArray` 方法。
- **路由类**：更新支持逻辑，以适配多站点模式，并且修复了url中出现问号导致404的问题。
- **模版引擎**：更新加载逻辑，以支持多站点模式。
- **启动程序**：更新加载逻辑，以支持多站点模式。

### 内容修正

- 增加说明文档，由AI生成后整理，有待完善...

### 其他调整

- 将 `common.php` 文件改为公共函数文件，用于存放全局函数。
- 新建 `constants.php` 文件，用于存放全局常量。

## 2024-11-5

### 功能改进

- 重新实现功能更丰富的模板引擎。

## 2024-11-4

### 内容修正

- 修改几处内容错误。

## 2024-11-3

### 项目进展

- 首次发布。

## 2024-11-1

### 项目启动

- 立项，突然想创建个项目玩。

- 就写个PHP框架吧，名字就暂定SharkyPHP。
